<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topic 3: è¯æ±‡äº’åŠ¨å­¦ä¹ ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8fafc; }
        .tab-active { border-bottom: 4px solid #f59e0b; color: #f59e0b; font-weight: bold; }
        .card-inner { transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; position: relative; }
        .flipped { transform: rotateY(180deg); }
        .card-face { backface-visibility: hidden; display: flex; align-items: center; justify-content: center; flex-direction: column; border-radius: 1rem; position: absolute; width: 100%; height: 100%; }
        .card-back { transform: rotateY(180deg); background-color: #fffbeb; border: 2px solid #fcd34d; }
    </style>
</head>
<body class="p-0 m-0">

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-6 flex justify-between items-center h-16">
            <h1 class="text-xl font-bold text-amber-600">Topic 3 è¯æ±‡å­¦ä¹ </h1>
            <div class="flex space-x-6 h-full">
                <button onclick="showTab('learn')" id="tab-learn" class="tab-active px-2 h-full">å­¦ä¹ </button>
                <button onclick="showTab('quiz')" id="tab-quiz" class="px-2 h-full text-gray-500">æµ‹è¯•</button>
                <button onclick="showTab('match')" id="tab-match" class="px-2 h-full text-gray-500">è¿çº¿æŒ‘æˆ˜</button>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-6">
        
        <!-- å­¦ä¹ æ¨¡å— -->
        <section id="view-learn" class="space-y-6">
            <div class="bg-amber-50 p-4 rounded-lg border-l-4 border-amber-400 mb-6">
                <p class="text-amber-800">ğŸ‘‹ æ¬¢è¿ï¼ç‚¹å‡»ä¸‹æ–¹çš„è¯å¡ï¼ŒæŸ¥çœ‹è¯¥è¯è¯­çš„è¯¦ç»†<b>ä¸­æ–‡è§£é‡Š</b>ã€‚é©¬æ¥æ–‡å°†ä½œä¸ºè¾…åŠ©å‚è€ƒã€‚</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="card-grid"></div>
        </section>

        <!-- æµ‹è¯•æ¨¡å— -->
        <section id="view-quiz" class="hidden max-w-2xl mx-auto">
            <div id="quiz-container" class="bg-white p-8 rounded-2xl shadow-xl border border-gray-100">
                <div class="flex justify-between mb-4 text-sm font-bold text-gray-400">
                    <span id="q-progress">é¢˜ç›® 1/12</span>
                    <span id="q-score">å¾—åˆ†: 0</span>
                </div>
                <h2 id="q-text" class="text-xl font-bold mb-6 text-gray-800">æ­£åœ¨å‡†å¤‡é¢˜ç›®...</h2>
                <div id="q-options" class="space-y-3"></div>
                <div id="q-feedback" class="hidden mt-6 p-4 rounded-lg"></div>
                <button id="btn-next" onclick="nextQuestion()" class="hidden mt-6 w-full bg-amber-500 text-white py-3 rounded-xl font-bold hover:bg-amber-600 transition-colors">ä¸‹ä¸€é¢˜</button>
            </div>
            
            <div id="quiz-result" class="hidden bg-white p-8 rounded-2xl shadow-xl text-center">
                <h2 class="text-2xl font-bold mb-4">æµ‹è¯•å®Œæˆï¼</h2>
                <div style="height: 250px; width: 100%; max-width: 300px; margin: 0 auto;" class="relative mb-6">
                    <canvas id="resultChart"></canvas>
                </div>
                <p id="result-summary" class="text-lg mb-6"></p>
                <button onclick="resetQuiz()" class="bg-amber-500 text-white px-8 py-3 rounded-xl font-bold">é‡æ–°å¼€å§‹</button>
            </div>
        </section>

        <!-- è¿çº¿æ¨¡å— -->
        <section id="view-match" class="hidden">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">ä¸­æ–‡è¯è¯­ä¸è¯ä¹‰è¿çº¿</h2>
                <p class="text-gray-500">ç‚¹å‡»å·¦ä¾§è¯è¯­ï¼Œå†é€‰æ‹©å³ä¾§å¯¹åº”çš„è¯¦ç»†è§£é‡Š</p>
            </div>
            <div class="flex justify-between items-start space-x-6 max-w-4xl mx-auto">
                <div id="match-zh" class="flex flex-col space-y-3 w-1/3"></div>
                <div id="match-desc" class="flex flex-col space-y-3 w-3/5"></div>
            </div>
            <div id="match-win" class="hidden mt-12 text-center">
                <div class="text-4xl mb-4">ğŸ‰</div>
                <h3 class="text-xl font-bold text-emerald-600">æŒ‘æˆ˜æˆåŠŸï¼ä½ å·²ç»æŒæ¡äº†è¿™äº›è¯ä¹‰</h3>
                <button onclick="initMatchGame()" class="mt-4 text-amber-600 underline font-bold">é‡æ–°æ‰“ä¹±å†ç©ä¸€æ¬¡</button>
            </div>
        </section>

    </main>

    <script>
        const data = [
            { zh: "æ»‹å‘³", ms: "Rasa", desc: "é£Ÿç‰©çš„å‘³é“ï¼Œæˆ–å¿ƒé‡Œçš„æŸç§æ„Ÿå— (Rasa)", tip: "é…¸ç”œè‹¦è¾£çš„æ»‹å‘³" },
            { zh: "å¿™ç¢Œ", ms: "Sibuk", desc: "äº‹æƒ…å¤ªå¤šï¼Œæ²¡æœ‰ç©ºé—²çš„æ—¶é—´ (Sibuk)", tip: "å·¥ä½œå¿™ç¢Œ" },
            { zh: "ä»“åº“", ms: "Gudang", desc: "ä¸“é—¨ç”¨æ¥å‚¨è—è´§ç‰©çš„æˆ¿å±‹ (Gudang)", tip: "å·¥å‚çš„ä»“åº“" },
            { zh: "è£¹", ms: "Balut", desc: "ç”¨çº¸ã€å¸ƒç­‰åŒ…æ‰æˆ–ç¼ ç»•èµ·æ¥ (Balut)", tip: "åŒ…è£¹ã€è£¹ä¼¤å£" },
            { zh: "ä¸¥å‰", ms: "Tegas", desc: "ä¸¥è‚ƒè€Œå‰å®³ï¼Œä¸æ”¾æ¾ (Tegas)", tip: "ä¸¥å‰çš„è€å¸ˆ" },
            { zh: "ä»æ…ˆ", ms: "Penyayang", desc: "ä»çˆ±æ…ˆå–„ï¼Œéå¸¸æœ‰çˆ±å¿ƒ (Penyayang)", tip: "ä»æ…ˆçš„é•¿è¾ˆ" },
            { zh: "é¼“åŠ±", ms: "Dorongan", desc: "æ¿€å‘ã€å‹‰åŠ±ï¼Œç»™äººåŠ¨åŠ›å’Œä¿¡å¿ƒ (Dorongan)", tip: "è€å¸ˆçš„é¼“åŠ±" },
            { zh: "æ„Ÿå¹", ms: "Mengeluh", desc: "æœ‰æ‰€æ„Ÿè§¦è€Œå¹æ¯ï¼Œå‘å‡ºæ„Ÿæ…¨ (Mengeluh)", tip: "å‘å‡ºæ„Ÿå¹" },
            { zh: "æ¼‚æ³Š", ms: "Merantau", desc: "ç¦»å¼€å®¶ä¹¡åˆ°å¤–åœ°ç”Ÿæ´» (Merantau)", tip: "åœ¨å¤–åœ°æ¼‚æ³Š" },
            { zh: "æœŸç›¼", ms: "Mengharapkan", desc: "æœŸå¾…å’Œç›¼æœ›ï¼Œå¸Œæœ›æŸäº‹å®ç° (Mengharapkan)", tip: "æœŸç›¼å‡æœŸ" },
            { zh: "æ’ä¹…", ms: "Abadi", desc: "æ°¸ä¹…ï¼Œé•¿ä¹…ä¸å˜ (Abadi)", tip: "æ’ä¹…çš„å‹è°Š" },
            { zh: "ä¼¼", ms: "Macam", desc: "ç›¸åƒï¼Œå¦‚åŒ (Macam)", tip: "çº¢å¾—ä¼¼ç«" }
        ];

        let currentQuizIndex = 0;
        let score = 0;
        let chart = null;
        let matchSelected = null;
        let matchCount = 0;

        window.onload = () => {
            renderCards();
            initQuiz();
            initMatchGame();
        };

        function showTab(tab) {
            ['learn', 'quiz', 'match'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('tab-' + t).className = "px-2 h-full text-gray-500";
            });
            document.getElementById('view-' + tab).classList.remove('hidden');
            document.getElementById('tab-' + tab).className = "tab-active px-2 h-full";
            if(tab === 'match') initMatchGame();
        }

        function renderCards() {
            const grid = document.getElementById('card-grid');
            grid.innerHTML = data.map(item => `
                <div class="h-44 relative card-flip" onclick="this.querySelector('.card-inner').classList.toggle('flipped')">
                    <div class="card-inner w-full h-full">
                        <div class="card-face bg-white shadow-md border border-gray-100">
                            <span class="text-2xl font-bold text-gray-800">${item.zh}</span>
                            <span class="text-sm text-amber-500 mt-2">${item.ms}</span>
                        </div>
                        <div class="card-face card-back p-4 text-center">
                            <p class="text-sm font-bold text-gray-700 mb-2">${item.desc}</p>
                            <p class="text-xs text-gray-400 italic">ä¾‹ï¼š${item.tip}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function initQuiz() {
            currentQuizIndex = 0;
            score = 0;
            showQuestion();
        }

        function showQuestion() {
            const q = data[currentQuizIndex];
            document.getElementById('q-progress').innerText = `é¢˜ç›® ${currentQuizIndex + 1}/${data.length}`;
            document.getElementById('q-text').innerText = `â€œ${q.zh} (${q.ms})â€ çš„æ„æ€æ˜¯ä»€ä¹ˆï¼Ÿ`;
            
            const options = [q.desc];
            while(options.length < 3) {
                let randomDesc = data[Math.floor(Math.random()*data.length)].desc;
                if(!options.includes(randomDesc)) options.push(randomDesc);
            }
            options.sort(() => Math.random() - 0.5);

            const optionsDiv = document.getElementById('q-options');
            optionsDiv.innerHTML = options.map(opt => `
                <button onclick="checkAnswer('${opt}', '${q.desc}')" class="w-full text-left p-4 rounded-xl border-2 border-gray-100 hover:border-amber-300 hover:bg-amber-50 transition-all font-medium text-gray-700">
                    ${opt}
                </button>
            `).join('');
            
            document.getElementById('q-feedback').classList.add('hidden');
            document.getElementById('btn-next').classList.add('hidden');
        }

        function checkAnswer(selected, correct) {
            const feedback = document.getElementById('q-feedback');
            feedback.classList.remove('hidden');
            if(selected === correct) {
                score++;
                feedback.className = "mt-6 p-4 rounded-lg bg-emerald-100 text-emerald-800 font-bold";
                feedback.innerText = "æ­£ç¡®ï¼ç­”å¯¹äº†ã€‚";
            } else {
                feedback.className = "mt-6 p-4 rounded-lg bg-red-100 text-red-800 font-bold";
                feedback.innerText = "ç­”é”™äº†ï¼Œæ­£ç¡®æ„æ€æ˜¯ï¼š" + correct;
            }
            document.querySelectorAll('#q-options button').forEach(b => b.disabled = true);
            document.getElementById('btn-next').classList.remove('hidden');
            document.getElementById('q-score').innerText = `å¾—åˆ†: ${score}`;
        }

        function nextQuestion() {
            currentQuizIndex++;
            if(currentQuizIndex < data.length) showQuestion();
            else showFinalResult();
        }

        function showFinalResult() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            document.getElementById('result-summary').innerText = `æ€»å…± ${data.length} é¢˜ï¼Œä½ ç­”å¯¹äº† ${score} é¢˜ï¼`;
            
            const ctx = document.getElementById('resultChart').getContext('2d');
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æ­£ç¡®', 'é”™è¯¯'],
                    datasets: [{
                        data: [score, data.length - score],
                        backgroundColor: ['#10b981', '#f43f5e']
                    }]
                },
                options: { maintainAspectRatio: false }
            });
        }

        function resetQuiz() {
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('quiz-result').classList.add('hidden');
            initQuiz();
        }

        // è¿çº¿æ¸¸æˆé€»è¾‘æ›´æ–°
        function initMatchGame() {
            matchCount = 0;
            matchSelected = null;
            document.getElementById('match-win').classList.add('hidden');
            
            // æ¯æ¬¡éšæœºé€‰ 6 ä¸ªè¯è¿›è¡Œè¿çº¿ï¼Œé˜²æ­¢å±å¹•å¤ªæ‹¥æŒ¤
            const sessionData = [...data].sort(() => Math.random() - 0.5).slice(0, 6);
            const zhList = [...sessionData].sort(() => Math.random() - 0.5);
            const descList = [...sessionData].sort(() => Math.random() - 0.5);

            document.getElementById('match-zh').innerHTML = zhList.map(item => `
                <button data-id="${item.zh}" onclick="handleMatch(this, 'zh')" class="p-4 bg-white border-2 border-gray-200 rounded-xl hover:shadow-md transition-all font-bold text-gray-800">${item.zh}</button>
            `).join('');
            
            document.getElementById('match-desc').innerHTML = descList.map(item => `
                <button data-id="${item.zh}" onclick="handleMatch(this, 'desc')" class="p-3 bg-white border-2 border-gray-200 rounded-xl hover:shadow-md transition-all text-sm text-left text-gray-600 font-medium h-full flex items-center">${item.desc}</button>
            `).join('');
        }

        function handleMatch(el, type) {
            if(el.classList.contains('bg-emerald-500')) return;

            // å¦‚æœä¹‹å‰æœ‰é€‰ä¸­çš„ï¼Œå…ˆæ¸…é™¤åŒç±»å‹çš„é€‰ä¸­çŠ¶æ€
            if (matchSelected && matchSelected.type === type) {
                matchSelected.el.classList.remove('border-amber-500', 'bg-amber-50');
                matchSelected = null;
            }

            if(!matchSelected) {
                matchSelected = { el, type, id: el.dataset.id };
                el.classList.add('border-amber-500', 'bg-amber-50');
            } else {
                // å¦‚æœç‚¹å‡»äº†ä¸åŒåˆ—
                if(matchSelected.type !== type && matchSelected.id === el.dataset.id) {
                    // åŒ¹é…æˆåŠŸ
                    el.className = "p-3 bg-emerald-500 text-white rounded-xl font-bold opacity-50 cursor-default flex items-center";
                    matchSelected.el.className = "p-4 bg-emerald-500 text-white rounded-xl font-bold opacity-50 cursor-default flex items-center justify-center";
                    matchCount++;
                    if(matchCount === 6) document.getElementById('match-win').classList.remove('hidden');
                    matchSelected = null;
                } else {
                    // åŒ¹é…å¤±è´¥
                    matchSelected.el.classList.remove('border-amber-500', 'bg-amber-50');
                    matchSelected = null;
                    // å¦‚æœç‚¹é”™äº†ï¼Œå¯ä»¥ç«‹å³é€‰ä¸­å½“å‰è¿™ä¸ª
                    handleMatch(el, type);
                }
            }
        }
    </script>
</body>
</html>