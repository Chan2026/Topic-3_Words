<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››å¹´çº§å•å…ƒäºŒï¼šæ£‹ç‹çš„å¿ƒäº‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f1f5f9; }
        .tab-active { border-bottom: 4px solid #10b981; color: #10b981; font-weight: bold; }
        .indent-2 { text-indent: 2em; }
        .diary-paper { 
            background-color: #fff;
            border: 1px solid #e2e8f0;
            position: relative;
        }
        .diary-paper::before {
            content: '';
            position: absolute;
            top: 0; left: 40px; height: 100%; width: 1px;
            background: #fee2e2;
        }
    </style>
    <!-- Firebase SDK é›†æˆ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // åˆå§‹åŒ–é…ç½®
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'chinese-learning-app';

        // åŒ¿åç™»å½•ä»¥ä¾¿å†™å…¥æ•°æ®
        signInAnonymously(auth).catch(console.error);

        // å¯¼å‡ºæäº¤å‡½æ•°åˆ°å…¨å±€ä¾›æ¸¸æˆè„šæœ¬è°ƒç”¨
        window.submitTestScore = async (scoreValue) => {
            const studentName = localStorage.getItem('studentName') || "æœªçŸ¥å­¦ç”Ÿ";
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'scores'), {
                    name: studentName,
                    score: scoreValue,
                    topic: "å•å…ƒäºŒï¼šè¿çº¿æ¸¸æˆ",
                    timestamp: serverTimestamp()
                });
                console.log("æˆç»©å·²ä¸Šä¼ ");
            } catch (e) {
                console.error("ä¸Šä¼ å¤±è´¥", e);
            }
        };
    </script>
</head>
<body class="text-gray-800">

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-6 flex justify-between items-center h-16">
            <div class="flex items-center space-x-3">
                <a href="index.html" class="flex items-center text-gray-400 hover:text-emerald-600 transition-colors" title="å›åˆ°é¦–é¡µ">
                    <span class="text-2xl">ğŸ </span>
                </a>
                <span class="text-gray-300">|</span>
                <h1 class="text-lg font-bold text-emerald-600">å•å…ƒäºŒï¼šæ£‹ç‹çš„å¿ƒäº‹</h1>
            </div>
            <div class="flex space-x-4 h-full text-sm sm:text-base">
                <button onclick="showTab('lesson')" id="tab-lesson" class="tab-active px-2 h-full">è¯¾æ–‡è§£æ</button>
                <button onclick="showTab('words')" id="tab-words" class="text-gray-500 px-2 h-full">è¯è¯­è®¤è¯†</button>
                <button onclick="showTab('game')" id="tab-game" class="text-gray-500 px-2 h-full">è¿çº¿æ¸¸æˆ</button>
                <button onclick="showTab('diary')" id="tab-diary" class="text-gray-500 px-2 h-full">æ—¥è®°èŒƒæ–‡</button>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-6">
        
        <!-- 1. è¯¾æ–‡è§£æ -->
        <section id="view-lesson" class="space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-8 border-emerald-500">
                <h2 class="text-xl font-bold mb-4">ä¸ºä»€ä¹ˆæ–‡è½©ä¸å¼€å¿ƒï¼Ÿ</h2>
                <p class="text-gray-700 leading-relaxed">
                    æ–‡è½©è¢«ç§°ä¸ºâ€œå°æ£‹ç‹â€ï¼Œä½†ä»–æœ€è¿‘äº§ç”Ÿäº†ä¸€ä»¶å¿ƒäº‹ï¼šä»–åœ¨ä¸€åœºé‡è¦çš„<strong>è±¡æ£‹æ¯”èµ›ä¸­è¾“äº†</strong>ã€‚å¤±è´¥çš„<strong>æ»‹å‘³</strong>è®©ä»–æ„Ÿåˆ°å¾ˆ<strong>ç„¦è™‘</strong>ï¼Œä»–å®³æ€•é¢å¯¹åˆ«äººçš„ç›®å…‰ï¼Œç”šè‡³æƒ³æ‹‰å¼€ä¸è±¡æ£‹çš„<strong>è·ç¦»</strong>ã€‚
                </p>
            </div>
            <div class="bg-emerald-50 p-6 rounded-xl">
                <h3 class="font-bold text-emerald-800 mb-2 text-lg">æ ¸å¿ƒé“ç†</h3>
                <p class="text-emerald-700">èƒœè´¥æ˜¯å…µå®¶å¸¸äº‹ï¼Œ<strong>å†µä¸”</strong>å¤±è´¥èƒ½è®©æˆ‘ä»¬å‘ç°è‡ªå·±çš„å¼±ç‚¹ï¼Œä»è€Œè®©æŠ€è‰ºæ›´ä¸Šä¸€å±‚æ¥¼ã€‚</p>
            </div>
        </section>

        <!-- 2. è¯è¯­è®¤è¯† -->
        <section id="view-words" class="hidden grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <div class="bg-white p-4 rounded-lg shadow-sm text-center border hover:border-emerald-300">
                <div class="text-xl font-bold text-emerald-600">æ»‹å‘³</div>
                <div class="text-sm text-gray-500 italic">Rasa</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm text-center border hover:border-emerald-300">
                <div class="text-xl font-bold text-emerald-600">ç„¦è™‘</div>
                <div class="text-sm text-gray-500 italic">Gelisah</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm text-center border hover:border-emerald-300">
                <div class="text-xl font-bold text-emerald-600">è·ç¦»</div>
                <div class="text-sm text-gray-500 italic">Jarak</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm text-center border hover:border-emerald-300">
                <div class="text-xl font-bold text-emerald-600">å†µä¸”</div>
                <div class="text-sm text-gray-500 italic">Lagipun</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm text-center border hover:border-emerald-300">
                <div class="text-xl font-bold text-emerald-600">ç´§å¯†</div>
                <div class="text-sm text-gray-500 italic">Rapat</div>
            </div>
        </section>

        <!-- 3. è¿çº¿æ¸¸æˆ -->
        <section id="view-game" class="hidden">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <p class="text-center mb-6 text-gray-500">ç‚¹å‡»å·¦è¾¹è¯è¯­ï¼Œå†ç‚¹å³è¾¹æ„æ€è¿›è¡Œé…å¯¹</p>
                <div class="flex justify-around gap-8">
                    <div id="game-left" class="space-y-4 w-1/3"></div>
                    <div id="game-right" class="space-y-4 w-1/2"></div>
                </div>
                <div id="game-win" class="hidden text-center mt-8 p-6 bg-emerald-100 text-emerald-800 rounded-xl">
                    <div class="text-3xl mb-2">ğŸ‰</div>
                    <p class="font-bold text-xl">å¤ªæ£’äº†ï¼å…¨éƒ¨é…å¯¹æ­£ç¡®ï¼</p>
                    <p class="text-sm mt-2 opacity-75">ä½ çš„æˆç»©å·²è‡ªåŠ¨å‘é€ç»™è€å¸ˆã€‚</p>
                </div>
            </div>
        </section>

        <!-- 4. æ—¥è®°èŒƒæ–‡ -->
        <section id="view-diary" class="hidden">
            <div class="diary-paper p-8 sm:p-12 shadow-xl max-w-2xl mx-auto rounded-sm min-h-[350px]">
                <div class="border-b-2 border-emerald-100 pb-2 mb-6 font-bold flex gap-4 text-gray-600">
                    <span>2024å¹´5æœˆ10æ—¥</span>
                    <span>æ˜ŸæœŸäº”</span>
                    <span>æ™´</span>
                </div>
                <div class="space-y-6 text-lg leading-loose text-gray-700">
                    <p class="indent-2">ä»Šå¤©æˆ‘éå¸¸éš¾è¿‡ï¼Œå› ä¸ºæˆ‘åœ¨è±¡æ£‹æ¯”èµ›ä¸­è¾“äº†ã€‚è¿™ç§å¤±è´¥çš„æ»‹å‘³çœŸä¸å¥½å—...</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        const words = [
            { zh: "æ»‹å‘³", ms: "å‘³é“æˆ–å†…å¿ƒçš„æ„Ÿå— (Rasa)" },
            { zh: "ç„¦è™‘", ms: "ç€æ€¥ã€çƒ¦æ¼å’Œä¸å®‰ (Gelisah)" },
            { zh: "å†µä¸”", ms: "è¡¨ç¤ºæ›´è¿›ä¸€å±‚ (Lagipun)" },
            { zh: "ç´§å¯†", ms: "ç»“åˆå¾—å¾ˆç´§ (Erat)" },
            { zh: "è·ç¦»", ms: "æ—¶é—´æˆ–ç©ºé—´çš„é—´éš” (Jarak)" }
        ];

        function showTab(tab) {
            ['lesson', 'words', 'game', 'diary'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('tab-' + t).className = "text-gray-500 px-2 h-full";
            });
            document.getElementById('view-' + tab).classList.remove('hidden');
            document.getElementById('tab-' + tab).className = "tab-active px-2 h-full";
            if(tab === 'game') initGame();
        }

        let selected = null;
        let count = 0;

        function initGame() {
            count = 0;
            selected = null;
            document.getElementById('game-win').classList.add('hidden');
            const left = [...words].sort(() => Math.random() - 0.5);
            const right = [...words].sort(() => Math.random() - 0.5);

            document.getElementById('game-left').innerHTML = left.map(w => `
                <div onclick="handlePick(this, '${w.zh}', 'L')" class="p-3 border-2 rounded-lg text-center cursor-pointer hover:bg-emerald-50 transition-colors">${w.zh}</div>
            `).join('');
            document.getElementById('game-right').innerHTML = right.map(w => `
                <div onclick="handlePick(this, '${w.zh}', 'R')" class="p-3 border-2 rounded-lg cursor-pointer hover:bg-emerald-50 transition-colors text-sm">${w.ms}</div>
            `).join('');
        }

        function handlePick(el, id, side) {
            if(el.classList.contains('bg-gray-100')) return;
            if(!selected) {
                selected = { el, id, side };
                el.classList.add('border-emerald-500', 'bg-emerald-50');
            } else {
                if(selected.side !== side && selected.id === id) {
                    el.className = "p-3 bg-emerald-500 text-white rounded-lg text-center opacity-40 cursor-default";
                    selected.el.className = "p-3 bg-emerald-500 text-white rounded-lg text-center opacity-40 cursor-default";
                    count++;
                    if(count === words.length) {
                        document.getElementById('game-win').classList.remove('hidden');
                        // è§¦å‘ä¸Šä¼ æˆç»©ï¼šæ»¡åˆ† 100
                        if(window.submitTestScore) window.submitTestScore(100);
                    }
                    selected = null;
                } else {
                    selected.el.classList.remove('border-emerald-500', 'bg-emerald-50');
                    selected = null;
                }
            }
        }
    </script>
</body>
</html>
