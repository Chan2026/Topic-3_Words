<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•å…ƒä¸‰ï¼šé¢‚èµæ¸©æƒ… - è¾¾æ ‡æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #fffaf0; font-family: sans-serif; }
        .option-btn { transition: all 0.2s; border: 2px solid #fed7aa; }
        .option-btn:hover { background-color: #ffedd5; transform: scale(1.02); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden border-4 border-orange-200">
        <!-- è¿›åº¦æ¡ -->
        <div class="bg-orange-100 h-2 w-full">
            <div id="progress" class="bg-orange-500 h-full transition-all" style="width: 0%"></div>
        </div>

        <div class="p-8">
            <!-- åšé¢˜ç•Œé¢ -->
            <div id="quiz-ui">
                <div class="flex justify-between items-center mb-6">
                    <span class="bg-orange-100 text-orange-700 px-4 py-1 rounded-full font-bold text-sm">å•å…ƒä¸‰ï¼šé¢‚èµæ¸©æƒ…</span>
                    <span id="q-count" class="text-gray-400 text-sm">é¢˜ç›® 1 / 3</span>
                </div>
                
                <h2 id="q-text" class="text-2xl font-bold text-gray-800 mb-8 leading-relaxed">æ­£åœ¨å‡†å¤‡é¢˜ç›®...</h2>
                
                <div id="options" class="grid gap-4">
                    <!-- é€‰é¡¹ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
            </div>

            <!-- ç»“æœç•Œé¢ -->
            <div id="result-ui" class="hidden text-center py-10">
                <div class="text-6xl mb-6">ğŸ‰</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-2">æµ‹è¯•å®Œæˆï¼</h2>
                <p id="score-text" class="text-5xl font-black text-orange-500 my-6">0 / 0</p>
                
                <!-- çŠ¶æ€æç¤ºæ¡† -->
                <div id="upload-status" class="bg-gray-50 border-2 border-dashed border-gray-200 rounded-2xl p-6 mb-6">
                    <p class="text-gray-500 animate-pulse">æ­£åœ¨å°†æˆç»©å‘é€ç»™è€å¸ˆ...</p>
                </div>

                <button onclick="location.href='index.html'" class="bg-gray-800 text-white px-8 py-3 rounded-xl font-bold hover:bg-black transition-colors">
                    è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // 1. æ•°æ®åº“é…ç½®
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = "bahasacina-years4-project"; // èº«ä»½è¯å¿…é¡»ç»Ÿä¸€

        // 2. é¢˜ç›®æ•°æ®
        const questions = [
            { q: "â€œæ»‹å‘³â€åœ¨æ–‡ä¸­çš„æ„æ€æœ€æ¥è¿‘ä»€ä¹ˆï¼Ÿ", a: "å‘³é“å’Œæ„Ÿå—", opts: ["å‘³é“å’Œæ„Ÿå—", "å¾ˆéš¾è¿‡", "éå¸¸å¿™ç¢Œ"] },
            { q: "æ–‡ä¸­æåˆ°â€œä»“åº“â€æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ", a: "å‚¨è—ç‰©èµ„", opts: ["ç©è€çš„åœ°æ–¹", "å‚¨è—ç‰©èµ„", "ä¹°ä¸œè¥¿çš„åœ°æ–¹"] },
            { q: "å“ªä¸€ä¸ªè¯è¯­å½¢å®¹â€œæ°¸è¿œä¸å˜â€ï¼Ÿ", a: "æ’ä¹…", opts: ["æš‚æ—¶", "æ’ä¹…", "ç«‹åˆ»"] }
        ];

        let currentIdx = 0;
        let score = 0;
        let studentName = localStorage.getItem('studentName') || "æœªçŸ¥å­¦ç”Ÿ";

        // 3. æ¸²æŸ“é¢˜ç›®
        function render() {
            const q = questions[currentIdx];
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('q-count').innerText = `é¢˜ç›® ${currentIdx + 1} / ${questions.length}`;
            document.getElementById('progress').style.width = `${((currentIdx) / questions.length) * 100}%`;
            
            const optDiv = document.getElementById('options');
            optDiv.innerHTML = '';
            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-5 text-left rounded-2xl font-bold text-gray-700 bg-white";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(opt);
                optDiv.appendChild(btn);
            });
        }

        // 4. å¤„ç†ç­”æ¡ˆ
        function handleAnswer(selected) {
            if(selected === questions[currentIdx].a) score++;
            currentIdx++;
            
            if(currentIdx < questions.length) {
                render();
            } else {
                showResult();
            }
        }

        // 5. æ˜¾ç¤ºç»“æœå¹¶ä¸Šä¼ 
        async function showResult() {
            document.getElementById('quiz-ui').classList.add('hidden');
            document.getElementById('result-ui').classList.remove('hidden');
            document.getElementById('score-text').innerText = `${score} / ${questions.length}`;
            document.getElementById('progress').style.width = `100%`;

            try {
                // åŒ¿åç™»å½•å¹¶ä¸Šä¼ 
                await signInAnonymously(auth);
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'scores'), {
                    studentName: studentName,
                    score: score,
                    total: questions.length,
                    topic: "å•å…ƒä¸‰ï¼šé¢‚èµæ¸©æƒ…",
                    timestamp: serverTimestamp()
                });
                
                document.getElementById('upload-status').innerHTML = `
                    <p class="text-green-600 font-bold text-lg">âœ… æˆç»©å·²æˆåŠŸå‘é€ç»™è€å¸ˆï¼</p>
                    <p class="text-gray-400 text-sm mt-1">è®°å½•å§“åï¼š${studentName}</p>
                `;
                document.getElementById('upload-status').className = "bg-green-50 border-2 border-green-200 rounded-2xl p-6 mb-6";
            } catch (err) {
                document.getElementById('upload-status').innerHTML = `
                    <p class="text-red-600 font-bold">âŒ å‘é€å¤±è´¥</p>
                    <p class="text-gray-400 text-sm">è¯·æ£€æŸ¥ç½‘ç»œæˆ–è”ç³»è€å¸ˆ</p>
                `;
            }
        }

        // å¯åŠ¨
        render();
    </script>
</body>
</html>
