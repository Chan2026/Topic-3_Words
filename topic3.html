<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•å…ƒä¸‰ï¼šé¢‚èµæ¸©æƒ… - åŒè¯­æµ‹è¯„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #fffaf0; }
        .tab-active { border-bottom: 4px solid #f59e0b; color: #f59e0b; font-weight: bold; }
        
        /* è¯æ±‡å¡ç‰‡ç¿»è½¬æ ·å¼ */
        .card-container { perspective: 1000px; height: 14rem; }
        .card-inner {
            position: relative; width: 100%; height: 100%;
            text-align: center; transition: transform 0.6s;
            transform-style: preserve-3d; cursor: pointer;
        }
        .card-container.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 1.5rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .card-front { background: white; border: 1px solid #fef3c7; }
        .card-back { 
            background: #fffbeb; border: 2px solid #fcd34d; 
            transform: rotateY(180deg); 
        }

        .progress-bar { transition: width 0.4s ease-in-out; }
        .opt-btn { transition: all 0.2s; border: 2px solid #f3f4f6; }
        .opt-btn:hover { border-color: #fbbf24; background-color: #fffbeb; }
    </style>
</head>
<body class="text-gray-800 pb-12">

    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-6 flex justify-between items-center h-16">
            <div class="flex items-center space-x-2">
                <a href="index.html" class="text-2xl hover:opacity-80">ğŸ </a>
                <span class="font-bold text-amber-700">å•å…ƒä¸‰ï¼šé¢‚èµæ¸©æƒ…</span>
            </div>
            <div class="flex space-x-4 h-full text-sm">
                <button onclick="switchTab('lesson')" id="tab-lesson" class="tab-active px-2 h-full">è¯¾æ–‡è§£æ</button>
                <button onclick="switchTab('words')" id="tab-words" class="text-gray-500 px-2 h-full">æ ¸å¿ƒè¯æ±‡åº“</button>
                <button onclick="switchTab('quiz')" id="tab-quiz" class="text-gray-500 px-2 h-full">è¾¾æ ‡æµ‹è¯•</button>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-6">
        
        <!-- 1. è¯¾æ–‡è§£æ -->
        <section id="view-lesson" class="space-y-6">
            <div class="bg-white p-8 rounded-3xl shadow-sm border-t-8 border-amber-500">
                <h2 class="text-2xl font-bold mb-4 text-amber-900">ã€Šé¢‚èµæ¸©æƒ…ã€‹ä¸»é¢˜è§£æ</h2>
                <p class="text-gray-700 leading-relaxed text-lg mb-4">
                    æœ¬å•å…ƒè®©æˆ‘ä»¬å­¦ä¼šæ„Ÿå—é‚£äº›è—åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­çš„â€œæ¸©æƒ…â€ã€‚æ— è®ºæ˜¯çˆ¶äº²å®½å¤§çš„è‚©è†€ï¼Œè¿˜æ˜¯æ¯äº²åŒ…è£¹çš„æ¸©æš–ï¼Œéƒ½æ˜¯æˆ‘ä»¬æˆé•¿çš„åŠ¨åŠ›ã€‚
                </p>
                <div class="bg-amber-50 p-4 rounded-xl border-l-4 border-amber-400">
                    <p class="text-amber-800 font-medium italic">â€œå®¶äººçš„çˆ±å¦‚åŒä¸€æŸå…‰ï¼Œåœ¨å¹³å‡¡çš„æ—¥å­é‡Œç»™äºˆæˆ‘ä»¬æ’ä¹…çš„æ¸©æš–ã€‚â€</p>
                </div>
            </div>
        </section>

        <!-- 2. æ ¸å¿ƒè¯æ±‡ (å¸¦ä¸­æ–‡è§£é‡Š) -->
        <section id="view-words" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- è¯æ±‡å¡ç‰‡ç”±JSæ¸²æŸ“ -->
        </section>

        <!-- 3. è¾¾æ ‡æµ‹è¯• -->
        <section id="view-quiz" class="hidden max-w-2xl mx-auto">
            <div class="bg-white rounded-3xl shadow-xl overflow-hidden border-2 border-amber-100">
                <div class="bg-gray-100 h-2 w-full">
                    <div id="progress-bar" class="bg-amber-500 h-full progress-bar w-0"></div>
                </div>
                <div class="p-8">
                    <div id="quiz-container">
                        <div class="flex justify-between items-center mb-6">
                            <span class="bg-amber-100 text-amber-700 px-3 py-1 rounded-lg font-bold text-xs">å•å…ƒä¸‰è¯­å¢ƒæŒ‘æˆ˜</span>
                            <span id="q-counter" class="text-gray-400 text-sm font-bold">é¢˜ç›® 1 / 12</span>
                        </div>
                        <h2 id="q-text" class="text-xl font-bold text-gray-800 mb-8 leading-relaxed min-h-[80px]"></h2>
                        <div id="opt-container" class="grid gap-4"></div>
                    </div>
                    <div id="result-container" class="hidden text-center py-10">
                        <div class="text-6xl mb-4">ğŸ“œ</div>
                        <h2 class="text-2xl font-bold text-gray-800">æµ‹è¯•å®Œæˆ</h2>
                        <p id="final-score" class="text-5xl font-black text-amber-600 my-6">0 / 12</p>
                        <div id="sync-status" class="text-sm text-gray-400 mb-6 font-medium">æ­£åœ¨ä¿å­˜è¿›åº¦...</div>
                        <button onclick="location.reload()" class="bg-amber-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-amber-700 w-full shadow-lg transition-all">é‡æ–°æŒ‘æˆ˜</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const vocabData = [
            { zh: "æ»‹å‘³", py: "zÄ« wÃ¨i", ms: "Perasaan/Rasa", desc: "å‘³é“æˆ–å†…å¿ƒçš„æ„Ÿå—ã€‚", icon: "ğŸµ" },
            { zh: "å¿™ç¢Œ", py: "mÃ¡ng lÃ¹", ms: "Sibuk", desc: "ä¸å¾—ç©ºï¼Œäº‹æƒ…å¾ˆå¤šã€‚", icon: "ğŸ’¼" },
            { zh: "ä»“åº“", py: "cÄng kÃ¹", ms: "Gudang", desc: "å‚¨è—ç‰©èµ„çš„å»ºç­‘ç‰©ã€‚", icon: "ğŸ¢" },
            { zh: "è£¹", py: "guÇ’", ms: "Balut", desc: "åŒ…ï¼Œç¼ ç»•ã€‚", icon: "ğŸ§£" },
            { zh: "ä¸¥å‰", py: "yÃ¡n lÃ¬", ms: "Tegas", desc: "ä¸¥è‚ƒè€Œå‰å®³ã€‚", icon: "ğŸ‘®" },
            { zh: "ä»æ…ˆ", py: "rÃ©n cÃ­", ms: "Penyayang", desc: "ä»çˆ±æ…ˆå–„ã€‚", icon: "ğŸ˜‡" },
            { zh: "é¼“åŠ±", py: "gÇ” lÃ¬", ms: "Dorongan", desc: "æ¿€å‘å‹‰åŠ±ã€‚", icon: "ğŸ”¥" },
            { zh: "æ„Ÿå¹", py: "gÇn tÃ n", ms: "Mengeluh", desc: "æœ‰æ„Ÿè€Œå¹æ¯ã€‚", icon: "ğŸ’¬" },
            { zh: "æ¼‚æ³Š", py: "piÄo bÃ³", ms: "Merantau", desc: "åœ¨å¤–å¥”æ³¢ï¼Œç”Ÿæ´»ä¸å›ºå®šã€‚", icon: "ğŸ›¶" },
            { zh: "æœŸç›¼", py: "qÄ« pÃ n", ms: "Mengharap", desc: "æœŸå¾…ç›¼æœ›ã€‚", icon: "ğŸŒŸ" },
            { zh: "æ’ä¹…", py: "hÃ©ng jiÇ”", ms: "Abadi", desc: "é•¿ä¹…ä¸å˜ã€‚", icon: "â³" },
            { zh: "ä¼¼", py: "shÃ¬", ms: "Seperti", desc: "åƒï¼Œå¦‚åŒã€‚", icon: "ğŸ–¼ï¸" }
        ];

        const quizData = [
            { q: "æ–‡ä¸­æåˆ°çˆ¶äº²åœ¨çƒˆæ—¥ä¸‹æµæ±—å·¥ä½œï¼Œé‚£ç§è¾›è‹¦çš„ï¼ˆ ï¼‰åªæœ‰ä»–è‡ªå·±çŸ¥é“ã€‚", a: "æ»‹å‘³ (Rasa/Perasaan)", opts: ["æ»‹å‘³ (Rasa/Perasaan)", "ä»“åº“ (Gudang)", "ä¼¼ (Macam)"] },
            { q: "çˆ¶äº²æ¯å¤©ä¸ºäº†ç”Ÿè®¡å››å¤„ï¼ˆ ï¼‰ï¼Œæ—©å‡ºæ™šå½’ï¼Œéå¸¸è¾›è‹¦ã€‚", a: "å¿™ç¢Œ (Sibuk)", opts: ["ä¸¥å‰ (Tegas)", "å¿™ç¢Œ (Sibuk)", "æœŸç›¼ (Mengharap)"] },
            { q: "çˆ¶äº²æŠŠè¾›è‹¦èµšæ¥çš„ç²®é£Ÿæ•´é½åœ°å †æ”¾åœ¨ï¼ˆ ï¼‰é‡Œã€‚", a: "ä»“åº“ (Gudang)", opts: ["ä»“åº“ (Gudang)", "æ„Ÿå¹ (Mengeluh)", "æ¼‚æ³Š (Merantau)"] },
            { q: "å†¬å¤©çš„æ—©æ™¨ï¼Œå¦ˆå¦ˆç”¨åšåšçš„å›´å·¾æŠŠæˆ‘çš„è„–å­ï¼ˆ ï¼‰å¾—ç´§ç´§çš„ã€‚", a: "è£¹ (Balut)", opts: ["æ’ä¹… (Abadi)", "ä¼¼ (Macam)", "è£¹ (Balut)"] },
            { q: "è™½ç„¶çˆ¶äº²å¹³æ—¶å¯¹æˆ‘çš„è¦æ±‚å¾ˆï¼ˆ ï¼‰ï¼Œä½†æˆ‘çŸ¥é“é‚£æ˜¯ä¸ºäº†æˆ‘å¥½ã€‚", a: "ä¸¥å‰ (Tegas)", opts: ["ä¸¥å‰ (Tegas)", "é¼“åŠ± (Dorongan)", "ä»æ…ˆ (Penyayang)"] },
            { q: "é¢å¯¹é‚£äº›æµç¦»å¤±æ‰€çš„ç¾æ°‘ï¼Œç‹ä¼¯ä¼¯è¡¨ç°å‡ºäº†æœ€ï¼ˆ ï¼‰çš„ä¸€é¢ã€‚", a: "ä»æ…ˆ (Penyayang)", opts: ["ä»æ…ˆ (Penyayang)", "æ»‹å‘³ (Rasa)", "å¿™ç¢Œ (Sibuk)"] },
            { q: "æ¯å½“æˆ‘è€ƒè¯•æˆç»©ä¸ç†æƒ³ï¼Œçˆ¶äº²æ€»æ˜¯æ‹æ‹æˆ‘çš„è‚©è†€ç»™æˆ‘ï¼ˆ ï¼‰ã€‚", a: "é¼“åŠ± (Dorongan)", opts: ["æœŸç›¼ (Mengharap)", "é¼“åŠ± (Dorongan)", "ä¼¼ (Macam)"] },
            { q: "çœ‹ç€æ—§ç›¸ç‰‡é‡Œçˆ¶äº²å¹´è½»çš„æ¨¡æ ·ï¼Œæˆ‘ä¸ç¦å‘å‡ºä¸€å£°ï¼ˆ ï¼‰ã€‚", a: "æ„Ÿå¹ (Mengeluh)", opts: ["ä»“åº“ (Gudang)", "æ„Ÿå¹ (Mengeluh)", "è£¹ (Balut)"] },
            { q: "ä¸ºäº†ç»™å®¶é‡Œå¯„é’±ï¼Œå”å”å¸¸å¹´åœ¨å¼‚ä¹¡ï¼ˆ ï¼‰ï¼Œå¾ˆå°‘å›æ¥ã€‚", a: "æ¼‚æ³Š (Merantau)", opts: ["æ¼‚æ³Š (Merantau)", "æ’ä¹… (Abadi)", "ä»æ…ˆ (Penyayang)"] },
            { q: "å¥¶å¥¶ååœ¨å¤§é—¨å£ï¼Œçœ¼ç¥é‡Œå……æ»¡äº†å¯¹å„¿å­™å½’å®¶çš„ï¼ˆ ï¼‰ã€‚", a: "æœŸç›¼ (Mengharap)", opts: ["å¿™ç¢Œ (Sibuk)", "æœŸç›¼ (Mengharap)", "ä»“åº“ (Gudang)"] },
            { q: "å®¶äººçš„å…³æ€€å¦‚åŒæ·±å¤œçš„ç¯ç«ï¼Œæ¸©æš–è€Œï¼ˆ ï¼‰ï¼Œæ°¸ä¸ç†„ç­ã€‚", a: "æ’ä¹… (Abadi)", opts: ["æ’ä¹… (Abadi)", "ä¼¼ (Macam)", "æ»‹å‘³ (Rasa)"] },
            { q: "æ¯çˆ±ï¼ˆ ï¼‰ä¸€è‚¡æ¸…æ³‰ï¼Œæ»‹æ¶¦ç€æˆ‘ä»¬è¿™äº›å¹¼è‹—çš„å¿ƒç”°ã€‚", a: "ä¼¼ (Seperti)", opts: ["ä¼¼ (Seperti)", "é¼“åŠ± (Dorongan)", "ä¸¥å‰ (Tegas)"] }
        ];

        let currentQIdx = 0;
        let score = 0;
        let db;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        async function init() {
            try {
                const config = JSON.parse(__firebase_config);
                const app = initializeApp(config);
                db = getFirestore(app);
                const auth = getAuth(app);
                await signInAnonymously(auth);
            } catch (e) { console.error("Firebase Auth Error"); }
            
            renderVocab();
            loadQuestion();
        }

        function renderVocab() {
            const container = document.getElementById('view-words');
            container.innerHTML = vocabData.map(word => `
                <div class="card-container" onclick="this.classList.toggle('flipped')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="text-4xl mb-3">${word.icon}</div>
                            <div class="text-2xl font-bold text-gray-800">${word.zh}</div>
                            <div class="text-sm text-amber-600 font-mono mt-1">${word.py}</div>
                            <div class="text-xs text-gray-400 mt-4 italic">ç‚¹å‡»ç¿»é¢æŸ¥çœ‹è¯¦ç»†è§£é‡Š</div>
                        </div>
                        <div class="card-back">
                            <div class="bg-amber-200 text-amber-800 px-3 py-1 rounded-full text-xs font-bold mb-3">${word.ms}</div>
                            <p class="text-gray-700 leading-relaxed font-medium px-4 text-lg">
                                ${word.desc}
                            </p>
                            <div class="mt-4 text-2xl">${word.icon}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadQuestion() {
            if (currentQIdx >= quizData.length) {
                showResults();
                return;
            }
            const q = quizData[currentQIdx];
            document.getElementById('q-counter').innerText = `é¢˜ç›® ${currentQIdx + 1} / ${quizData.length}`;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('progress-bar').style.width = `${(currentQIdx / quizData.length) * 100}%`;

            const optBox = document.getElementById('opt-container');
            optBox.innerHTML = '';
            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "opt-btn w-full text-left p-4 rounded-2xl bg-white font-bold text-gray-700 shadow-sm";
                btn.innerText = opt;
                btn.onclick = () => {
                    if(opt === q.a) score++;
                    currentQIdx++;
                    loadQuestion();
                };
                optBox.appendChild(btn);
            });
        }

        async function showResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('result-container').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score} / ${quizData.length}`;
            
            if (db) {
                const name = localStorage.getItem('studentName') || "åŒ¿åå­¦ç”Ÿ";
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'scores'), {
                        name: name,
                        score: score,
                        total: 12,
                        topic: "å•å…ƒä¸‰ï¼šé¢‚èµæ¸©æƒ…æµ‹è¯•",
                        timestamp: serverTimestamp()
                    });
                    document.getElementById('sync-status').innerText = "âœ… æˆç»©å·²åŒæ­¥è‡³æ•™å¸ˆç«¯";
                } catch (e) {
                    document.getElementById('sync-status').innerText = "âš ï¸ æˆç»©å·²ä¿å­˜æœ¬åœ°";
                }
            }
        }

        window.switchTab = (tab) => {
            ['lesson', 'words', 'quiz'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('tab-' + t).className = "text-gray-500 px-2 h-full";
            });
            document.getElementById('view-' + tab).classList.remove('hidden');
            document.getElementById('tab-' + tab).className = "tab-active px-2 h-full";
        };

        init();
    </script>
</body>
</html>
